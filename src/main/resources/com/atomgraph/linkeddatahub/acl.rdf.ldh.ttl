@base           <http://www.w3.org/ns/auth/acl> .

@prefix :       <#> .
@prefix rdf:	<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:	<http://www.w3.org/2000/01/rdf-schema#> .
@prefix ldh:	<https://w3id.org/atomgraph/linkeddatahub#> .
@prefix sp:	<http://spinrdf.org/sp#> .
@prefix spin:	<http://spinrdf.org/spin#> .
@prefix dct:	<http://purl.org/dc/terms/> .

# AUTHORIZATION

:Authorization spin:constructor [
        a sp:Construct ;
        sp:text """
            PREFIX dct:     <http://purl.org/dc/terms/>
            PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>
            PREFIX owl:     <http://www.w3.org/2002/07/owl#>
            PREFIX xsd:     <http://www.w3.org/2001/XMLSchema#>
            PREFIX acl:     <http://www.w3.org/ns/auth/acl#>
            PREFIX foaf:    <http://xmlns.com/foaf/0.1/>

            CONSTRUCT {
                ?this rdfs:label [ a xsd:string ] ;
                    dct:description [ a xsd:string ] ;
                    acl:mode [ a acl:Mode ] ;
                    acl:accessTo [ a rdfs:Resource ] ;
                    acl:accessToClass [ a owl:Class ] ;
                    acl:agent [ a foaf:Agent ] ;
                    acl:agentClass [ a owl:Class ] ;
                    acl:agentGroup [ a foaf:Group ] .
            }
            WHERE {}"""
    ] ;
    spin:constraint [
        a ldh:MissingPropertyValue ;
            sp:arg1 :mode
    ], [
        a ldh:MissingPropertyValue ;
            sp:arg1 rdfs:label
    ] ;
    ldh:template :AuthorizationAgents .

:AuthorizationAgents a ldh:Content ;
    rdf:first :SelectAuthorizationAgents ;
    rdf:rest rdf:nil .

:SelectAuthorizationAgents a sp:Select ;
    dct:title "Select agents" ;
    sp:text """
PREFIX  foaf: <http://xmlns.com/foaf/0.1/>
PREFIX  acl:  <http://www.w3.org/ns/auth/acl#>

SELECT DISTINCT  ?agent
WHERE
{ GRAPH ?authGraph
  { ?this  foaf:primaryTopic  ?auth .
    ?auth  acl:agent          ?agent
  }
}
""" .
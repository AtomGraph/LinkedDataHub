@base		<https://w3id.org/atomgraph/linkeddatahub/default> .

@prefix :	<#> .
@prefix lapp:   <https://w3id.org/atomgraph/linkeddatahub/apps#> .
@prefix ldh:	<https://w3id.org/atomgraph/linkeddatahub#> .
@prefix rdf:	<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:	<http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:	<http://www.w3.org/2002/07/owl#> .
@prefix dh:	<https://www.w3.org/ns/ldt/document-hierarchy#> .
@prefix sd:	<http://www.w3.org/ns/sparql-service-description#> .
@prefix sp:	<http://spinrdf.org/sp#> .
@prefix spin:	<http://spinrdf.org/spin#> .
@prefix sioc:	<http://rdfs.org/sioc/ns#> .
@prefix foaf:	<http://xmlns.com/foaf/0.1/> .
@prefix dct:	<http://purl.org/dc/terms/> .
@prefix nfo:	<http://www.semanticdesktop.org/ontologies/2007/03/22/nfo#> .

: a owl:Ontology ;
    rdfs:label "Default" ;
    rdfs:comment "Default document model" ;
    owl:imports ldh:, lapp:, dh:, sp: ;
    owl:versionInfo "1.0-SNAPSHOT" .

:Root rdfs:subClassOf dh:Container ;
    spin:constructor :TitleConstructor, :DescriptionConstructor, :PrimaryTopicConstructor, :ContentConstructor ;
    spin:constraint :MissingTitle ; # roots do not have parents, therefore no :MissingParent
    ldh:template ldh:ContainerChildren ;
    rdfs:label "Root" ;
    rdfs:isDefinedBy : .

:TitleConstructor a sp:Construct ;
    rdfs:label "Title constructor" ;
    sp:text """
        PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX xsd:     <http://www.w3.org/2001/XMLSchema#>
        PREFIX dct:     <http://purl.org/dc/terms/>

        CONSTRUCT {
          ?this dct:title [ a xsd:string ] .
        }
        WHERE {}""" ;
    rdfs:isDefinedBy : .

:DescriptionConstructor a sp:Construct ;
    rdfs:label "Description constructor" ;
    sp:text """
        PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX xsd:     <http://www.w3.org/2001/XMLSchema#>
        PREFIX dct:     <http://purl.org/dc/terms/>

        CONSTRUCT {
          ?this dct:description [ a xsd:string ] .
        }
        WHERE {}""" ;
    rdfs:isDefinedBy : .

:PrimaryTopicConstructor a sp:Construct ;
    rdfs:label "Primary topic constructor" ;
    sp:text """
        PREFIX foaf:    <http://xmlns.com/foaf/0.1/>
        PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>

        CONSTRUCT {
          ?this foaf:primaryTopic [ a rdfs:Resource ] .
        }
        WHERE {}""" ;
    rdfs:isDefinedBy : .

:ContentConstructor a sp:Construct ;
    rdfs:label "Content constructor" ;
    sp:text """
        PREFIX ldh:     <https://w3id.org/atomgraph/linkeddatahub#>

        CONSTRUCT {
          ?this ldh:content [ a ldh:Content ] .
        }
        WHERE {}""" ;
    rdfs:isDefinedBy : .

:MissingTitle a ldh:MissingPropertyValue ;
    rdfs:label "Missing title" ;
    rdfs:comment "Requires resources to have a title from Dublin Core Terms vocabulary" ;
    sp:arg1 dct:title ;
    rdfs:isDefinedBy : .

:SelectLabelled a sp:Select ;
    rdfs:label "Select labelled" ;
    sp:text """
PREFIX  dct:  <http://purl.org/dc/terms/>
PREFIX  schema2: <https://schema.org/>
PREFIX  rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX  schema1: <http://schema.org/>
PREFIX  skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX  rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX  foaf: <http://xmlns.com/foaf/0.1/>
PREFIX  sioc: <http://rdfs.org/sioc/ns#>
PREFIX  dc:   <http://purl.org/dc/elements/1.1/>

SELECT DISTINCT  ?resource
WHERE
  { GRAPH ?graph
      { ?resource  rdf:type  ?Type .
        ?resource (((((((((rdfs:label|dc:title)|dct:title)|foaf:name)|foaf:givenName)|foaf:familyName)|sioc:name)|skos:prefLabel)|sioc:content)|schema1:name)|schema2:name ?label
        FILTER isURI(?resource)
      }
  }
    """ ;
    rdfs:isDefinedBy : .

### EXTERNAL ASSERTIONS

# https://www.w3.org/ns/ldt/document-hierarchy

dh:Item spin:constructor :TitleConstructor, :DescriptionConstructor, :PrimaryTopicConstructor, :ContentConstructor ;
    spin:constraint :MissingContainer, :MissingTitle .

:MissingContainer a ldh:MissingPropertyValue ;
    rdfs:label "Missing container" ;
    rdfs:comment "Requires items to have a parent container" ;
    sp:arg1 sioc:has_container ;
    rdfs:isDefinedBy : .

dh:Container spin:constructor :TitleConstructor, :DescriptionConstructor, :PrimaryTopicConstructor, :ContentConstructor ;
    spin:constraint :MissingParent, :MissingTitle ;
    ldh:template ldh:ContainerChildren .

:MissingParent a ldh:MissingPropertyValue ;
    rdfs:label "Missing parent" ;
    rdfs:comment "Requires containers to have a parent container" ;
    sp:arg1 sioc:has_parent ;
    rdfs:isDefinedBy : .

# http://spinrdf.org/sp

sp:Query spin:constructor :TitleConstructor, :DescriptionConstructor .
    # spin:constraint :MissingTitle .

# https://w3id.org/atomgraph/linkeddatahub#

ldh:Import spin:constructor :TitleConstructor, :DescriptionConstructor ;
    spin:constraint :MissingTitle .

ldh:Chart spin:constructor :TitleConstructor, :DescriptionConstructor ;
    spin:constraint :MissingTitle .

nfo:FileDataObject spin:constructor :TitleConstructor, :DescriptionConstructor ;
    spin:constraint :MissingTitle .

sd:Service spin:constructor :TitleConstructor, :DescriptionConstructor ;
    spin:constraint :MissingTitle .

# https://w3id.org/atomgraph/linkeddatahub/apps

lapp:Application spin:constructor :TitleConstructor, :DescriptionConstructor ;
    spin:constraint :MissingTitle .